<!DOCTYPE html>
<html lang="vi">
<head>
<link href="https://images.rbxcdn.com/e854eb7b2951ac03edba9a2681032bba.ico" rel="icon">
<meta charset="UTF-8">
<title>S√†n Giao D·ªãch Ch·ª©ng Kho√°n</title>
<style>
:root{
    --bg:#0b1220;
    --panel:#111827;
    --border:#1f2937;
    --green:#22c55e;
    --red:#ef4444;
    --blue:#38bdf8;
}
body{
    margin:0;
    font-family:Segoe UI, Arial;
    background:var(--bg);
    color:white;
}
header{
    padding:15px 20px;
    background:#020617;
    border-bottom:1px solid var(--border);
    font-size:20px;
}
.container{
    display:grid;
    grid-template-columns: 2fr 1fr;
    gap:15px;
    padding:15px;
}
.panel{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:8px;
    padding:15px;
}
.money{
    font-size:18px;
    margin-bottom:10px;
}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    padding:10px;
    border-bottom:1px solid var(--border);
    text-align:center;
}
th{
    color:#94a3b8;
    font-weight:600;
}
.up{color:var(--green);}
.down{color:var(--red);}
button{
    background:#020617;
    color:white;
    border:1px solid var(--border);
    padding:6px 10px;
    border-radius:5px;
    cursor:pointer;
}
button:hover{background:#020617cc}
canvas{
    width:100%;
    height:260px;
}
.asset{
    display:flex;
    justify-content:space-between;
    margin:6px 0;
    color:#cbd5f5;
}
body::before{
    content:"";
    position:fixed;
    inset:0;
    padding:6px;
    background:linear-gradient(
        90deg,
        #22c55e,
        #38bdf8,
        #a855f7,
        #ef4444,
        #22c55e
    );
    background-size:400% 400%;
    animation:borderGlow 8s linear infinite;
    -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
    -webkit-mask-composite:xor;
    mask-composite:exclude;
    pointer-events:none;
    z-index:9999;
}

@keyframes borderGlow{
    0%{background-position:0% 50%}
    100%{background-position:400% 50%}
}
/* ================= MOBILE ================= */
@media (max-width: 768px) {

    header {
        font-size: 16px;
        text-align: center;
    }

    .container {
        grid-template-columns: 1fr; /* 1 c·ªôt */
    }

    table {
        display: block;
        overflow-x: auto; /* cu·ªôn ngang */
        white-space: nowrap;
    }

    th, td {
        padding: 8px;
        font-size: 14px;
    }

    button {
        padding: 10px 14px;
        font-size: 14px;
    }

    canvas {
        height: 220px;
    }

    .money {
        font-size: 16px;
        text-align: center;
    }

    #musicBtn {
        bottom: 15px;
        right: 15px;
        padding: 12px 16px;
        font-size: 18px;
    }
}


</style>
</head>
<audio id="bgMusic" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
</audio>

<button id="musicBtn" onclick="toggleMusic()" style="
position:fixed;
bottom:20px;
right:20px;
z-index:999;
padding:10px 14px;
border-radius:50%;
border:1px solid #1f2937;
background:#020617;
color:white;
cursor:pointer;">
üéµ
</button>

<body>

<header>üìä S√ÄN CH·ª®NG KHO√ÅN (M√î PH·ªéNG)</header>

<div class="container">

<!-- B·∫¢NG GI√Å -->
<div class="panel">
    <div class="money">üí∞ S·ªë d∆∞: <b id="money">10000</b></div>

    <table>
        <thead>
            <tr>
                <th>M√£</th>
                <th>Gi√°</th>
                <th>+/-</th>
                <th>S·ªü h·ªØu</th>
                <th>Giao d·ªãch</th>
            </tr>
        </thead>
        <tbody id="market"></tbody>
    </table>
</div>

<!-- BI·ªÇU ƒê·ªí + T√ÄI S·∫¢N -->
<div class="panel">
    <h3>üìà Bi·ªÉu ƒë·ªì gi√°</h3>
    <canvas id="chart" width="400" height="260"></canvas>

    <h3>üíº Danh m·ª•c</h3>
    <div id="portfolio"></div>
</div>

</div>

<script>
    function saveData(){
    localStorage.setItem("marketData", JSON.stringify({
        money,
        stocks
    }));
}
const oldRender = render;
render = function(){
    oldRender();
    saveData();
}

    // ===== NH·∫†C N·ªÄN =====
   let music;
let playing = false;

window.addEventListener("click", () => {
    if (!music) {
        music = document.getElementById("bgMusic");
    }
}, { once: true });

function toggleMusic(){
    if(!music){
        music = document.getElementById("bgMusic");
    }

    if(!playing){
        music.play().then(()=>{
            playing = true;
        }).catch(err=>{
            alert("‚ùå Tr√¨nh duy·ªát ch·∫∑n √¢m thanh. H√£y b·∫•m l·∫°i!");
            console.log(err);
        });
    }else{
        music.pause();
        playing = false;
    }
}


function toggleMusic(){
    if(!playing){
        music.play();
        playing = true;
    }else{
        music.pause();
        playing = false;
    }
}

let money = 10000;

let stocks = [
    {code:"tri·∫øt huy·ªÅn",price:150,owned:0,change:0},
    {code:"hi·∫øu th·∫£o",price:120,owned:0,change:0},
    {code:"nghƒ©a linh",price:100,owned:0,change:0},
    {code:"t√†i huy·ªÅn",price:70,owned:0,change:0}
];
// ===== GHI LOG GIAO D·ªäCH =====
function logTrade(action, stock){
    let logs = JSON.parse(localStorage.getItem("logs") || "[]");
    logs.push({
        user: user ? user.name : "Kh√°ch",
        action: action,
        code: stock.code,
        price: stock.price,
        time: new Date().toLocaleString()
    });
    localStorage.setItem("logs", JSON.stringify(logs));
}


function render(){
    document.getElementById("money").innerText = money.toFixed(0);
    let rows="", assets="";
    stocks.forEach((s,i)=>{
        let cls=s.change>=0?"up":"down";
        let sign=s.change>=0?"+":"";
        rows+=`
        <tr>
            <td>${s.code}</td>
            <td>${s.price}</td>
            <td class="${cls}">${sign}${s.change}</td>
            <td>${s.owned}</td>
            <td>
                <button onclick="buy(${i})">Mua</button>
                <button onclick="sell(${i})">B√°n</button>
            </td>
        </tr>`;
        if(s.owned>0){
            assets+=`<div class="asset">
                <span>${s.code} (${s.owned})</span>
                <span>${s.owned*s.price}</span>
            </div>`;
        }
    });
    document.getElementById("market").innerHTML=rows;
    document.getElementById("portfolio").innerHTML=assets||"<i>Ch∆∞a c√≥ c·ªï phi·∫øu</i>";
    drawChart();
}

function buy(i){
    if(money >= stocks[i].price){
        money -= stocks[i].price;
        stocks[i].owned++;

        logTrade("MUA", stocks[i]); // ‚úÖ TH√äM D√íNG N√ÄY

        render();
    } else alert("‚ùå Kh√¥ng ƒë·ªß ti·ªÅn!");
}

function sell(i){
    if(stocks[i].owned > 0){
        money += stocks[i].price;
        stocks[i].owned--;

        logTrade("B√ÅN", stocks[i]); // ‚úÖ TH√äM D√íNG N√ÄY

        render();
    } else alert("‚ùå Kh√¥ng c√≥ c·ªï phi·∫øu!");
}


// BI·ªÇU ƒê·ªí C·ªòT
function drawChart(){
    const c=document.getElementById("chart");
    const ctx=c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);
    let max=Math.max(...stocks.map(s=>s.price));
    let w=60,g=30;
    stocks.forEach((s,i)=>{
        let h=s.price/max*180;
        let x=i*(w+g)+40;
        let y=c.height-h-30;
        ctx.fillStyle="#38bdf8";
        ctx.fillRect(x,y,w,h);
        ctx.fillStyle="white";
        ctx.textAlign="center";
        ctx.fillText(s.code,x+w/2,c.height-10);
        ctx.fillText(s.price,x+w/2,y-5);
    });
}

// GI√Å CH·∫†Y NH∆Ø S√ÄN
setInterval(()=>{
    stocks.forEach(s=>{
        let ch=Math.floor(Math.random()*12-6);
        s.change=ch;
        s.price+=ch;
        if(s.price<1)s.price=1;
    });
    render();
},2000);
function logTrade(action, stock){
    let logs = JSON.parse(localStorage.getItem("logs") || "[]");
    logs.push({
        user: user.name,
        action: action,
        code: stock.code,
        price: stock.price,
        time: new Date().toLocaleString()
    });
    localStorage.setItem("logs", JSON.stringify(logs));
}

render();
let saved = localStorage.getItem("marketData");
if(saved){
    let data = JSON.parse(saved);
    money = data.money;
    stocks = data.stocks;
}
render();

</script>

</body>
</html>
